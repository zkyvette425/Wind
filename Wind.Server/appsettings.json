{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning",
      "Orleans": "Information",
      "MagicOnion": "Information"
    }
  },
  "AllowedHosts": "*",
  
  
  "MagicOnion": {
    "Server": {
      "Port": 5271,
      "EnableReflectionService": false
    }
  },
  
  "ConnectionStrings": {
    "Redis": "localhost:6379,password=windgame123",
    "Garnet": "localhost:6380,password=windgame123",
    "MongoDB": "mongodb://windapp:windapp123@localhost:27017/windgame"
  },
  
  "Redis": {
    "ConnectionString": "localhost:6379",
    "Database": 0,
    "ConnectTimeout": 5000,
    "SyncTimeout": 5000,
    "AsyncTimeout": 5000,
    "PoolSize": 10,
    "EnableSsl": false,
    "Password": "windgame123",
    "Username": null,
    "EnableCluster": false,
    "KeyPrefix": "Wind:v1.2:",
    "DefaultTtlSeconds": 3600,
    "EnableCompression": true,
    "RetryCount": 3,
    "RetryDelay": 1000,
    "EnableHealthCheck": true,
    "HealthCheckIntervalSeconds": 30
  },

  "Garnet": {
    "ConnectionString": "localhost:6380",
    "Database": 0,
    "ConnectTimeout": 5000,
    "SyncTimeout": 5000,
    "AsyncTimeout": 5000,
    "PoolSize": 10,
    "EnableSsl": false,
    "Password": "windgame123",
    "Username": null,
    "EnableCluster": false,
    "KeyPrefix": "Wind:Garnet:",
    "DefaultTtlSeconds": 3600,
    "EnableCompression": true,
    "RetryCount": 3,
    "RetryDelay": 1000,
    "EnableHealthCheck": true,
    "HealthCheckIntervalSeconds": 30
  },
  
  // Orleans配置已移动到代码中（见Program.cs中的UseOrleans配置）
  // 避免配置文件与代码配置冲突
  
  "MongoDB": {
    "ConnectionString": "mongodb://windapp:windapp123@localhost:27017",
    "DatabaseName": "windgame",
    "ConnectTimeout": 10000,
    "SocketTimeout": 30000,
    "ServerSelectionTimeout": 10000,
    "MaxConnectionPoolSize": 100,
    "MinConnectionPoolSize": 5,
    "MaxConnectionIdleTime": 600000,
    "MaxConnectionLifeTime": 1800000,
    "UseSsl": false,
    "ReadPreference": "Primary",
    "WriteConcern": "Acknowledged",
    "ReadConcern": "Local",
    "RetryWrites": true,
    "RetryReads": true,
    "EnableHealthCheck": true,
    "HealthCheckIntervalSeconds": 60,
    "Collections": {
      "Players": "players",
      "Rooms": "rooms",
      "Matchmaking": "matchmaking",
      "GameRecords": "game_records",
      "PlayerStats": "player_stats",
      "SystemLogs": "system_logs",
      "AuditLogs": "audit_logs"
    }
  },
  
  "DataSync": {
    "FlushIntervalMs": 5000,
    "FlushBatchSize": 100,
    "MaxPendingWrites": 1000,
    "DefaultCacheExpirySeconds": 3600,
    "EnableStatistics": true,
    "TypeCollectionMapping": {
      "PlayerState": "players",
      "RoomState": "rooms",
      "MessageInfo": "messages",
      "UserSession": "sessions",
      "MatchmakingInfo": "matchmaking",
      "GameRecord": "game_records"
    },
    "MongoCollections": [
      "players",
      "rooms",
      "messages",
      "sessions",
      "matchmaking",
      "game_records",
      "player_stats",
      "system_logs",
      "audit_logs"
    ],
    "SyncStrategy": {
      "DefaultStrategy": "WriteThrough",
      "TypeStrategyOverrides": {
        "PlayerState": "WriteThrough",
        "RoomState": "WriteThrough",
        "MessageInfo": "WriteBehind",
        "UserSession": "CacheAside",
        "MatchmakingInfo": "WriteBehind",
        "GameRecord": "WriteBehind"
      },
      "WriteBehind": {
        "HighPriorityTypes": ["PlayerState", "RoomState"],
        "HighPriorityFlushIntervalMs": 2000,
        "MaxDataAgeMs": 30000
      },
      "CacheAside": {
        "PreloadTypes": ["UserSession"],
        "TypeCacheTtlSeconds": {
          "PlayerState": 1800,
          "RoomState": 900,
          "MessageInfo": 3600,
          "UserSession": 7200,
          "MatchmakingInfo": 300,
          "GameRecord": 86400
        }
      }
    }
  },
  
  "LruCache": {
    "MaxCapacity": 15000,
    "DefaultExpiryMinutes": 45,
    "CleanupIntervalMinutes": 10,
    "EvictionThreshold": 0.75,
    "EvictionBatchSize": 150,
    "EnableStatistics": true,
    "KeyPrefix": "Wind:Cache:",
    "EnableAutoCleanup": true,
    "TargetHitRate": 92.0
  },
  
  "DistributedLock": {
    "DefaultExpiryMinutes": 5,
    "DefaultTimeoutSeconds": 30,
    "RetryIntervalMs": 50,
    "KeyPrefix": "Lock:Wind:",
    "EnableAutoRenewal": true,
    "AutoRenewalRatio": 0.6,
    "EnableStatistics": true,
    "MaxRetries": 200
  },
  
  "JwtSettings": {
    "SecretKey": "Wind-Game-Server-Development-JWT-Secret-Key-2025-Very-Secure-Random-String-For-Development-Only",
    "Issuer": "Wind.GameServer",
    "Audience": "Wind.GameClient",
    "AccessTokenExpiryMinutes": 15,
    "RefreshTokenExpiryDays": 7,
    "ValidateIssuer": true,
    "ValidateAudience": true,
    "ValidateLifetime": true,
    "ValidateIssuerSigningKey": true,
    "ClockSkewMinutes": 2
  },
  
  "Serilog": {
    "Using": ["Serilog.Sinks.Console", "Serilog.Sinks.File", "Serilog.Sinks.Seq"],
    "MinimumLevel": {
      "Default": "Information",
      "Override": {
        "Microsoft": "Warning",
        "System": "Warning",
        "Orleans": "Information"
      }
    },
    "WriteTo": [
      {
        "Name": "Console",
        "Args": {
          "outputTemplate": "[{Timestamp:HH:mm:ss} {Level:u3}] {Message:lj} {Properties:j}{NewLine}{Exception}"
        }
      },
      {
        "Name": "File",
        "Args": {
          "path": "logs/log.txt",
          "rollingInterval": "Day",
          "retainedFileCountLimit": 7,
          "outputTemplate": "[{Timestamp:yyyy-MM-dd HH:mm:ss.fff zzz} {Level:u3}] {Message:lj} {Properties:j}{NewLine}{Exception}"
        }
      },
      {
        "Name": "Seq",
        "Args": {
          "serverUrl": "http://localhost:5341"
        }
      }
    ],
    "Enrich": ["FromLogContext", "WithMachineName", "WithThreadId"]
  }
}
