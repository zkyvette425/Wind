# 决策记录

## 说明
记录重要技术决策的来龙去脉，包括决策背景、备选方案、选择原因和预期影响。

---

## ADR-001: 采用Microsoft Orleans作为核心架构

### 决策日期
2025-08-11 (北京时间)

### 决策状态
✅ 已采纳

### 决策背景
需要构建支持分布式扩展的游戏服务器框架，原有的ASP.NET Core + SignalR方案在大规模并发场景下存在性能和扩展性限制。

### 备选方案
1. **传统ASP.NET Core + SignalR**
   - 优点: 团队熟悉，开发成本低
   - 缺点: 分布式支持有限，难以水平扩展，状态管理复杂

2. **自建Actor系统**
   - 优点: 完全可控，定制化程度高
   - 缺点: 开发工作量巨大，稳定性风险高，维护成本高

3. **Microsoft Orleans**
   - 优点: 成熟的虚拟Actor框架，自动容错，内置分布式支持，已在AAA游戏验证
   - 缺点: 学习成本，与现有技能栈差异较大

4. **Akka.NET**
   - 优点: 成熟的Actor框架，Java生态移植
   - 缺点: 相对复杂，文档和社区支持不如Orleans

### 决策选择
选择Microsoft Orleans

### 选择理由
1. **技术成熟度**: Orleans在Halo等大型游戏中已得到验证
2. **分布式支持**: 内置集群管理、负载均衡、故障转移
3. **开发效率**: Virtual Actor模型简化了分布式编程
4. **微软生态**: 与.NET生态完美集成，长期支持保证
5. **性能优势**: 内存中状态管理，超低延迟

### 预期影响
- **正面**: 显著提升并发处理能力和系统可扩展性
- **负面**: 团队需要学习新的编程模型，短期开发效率可能下降
- **风险缓解**: 通过Context7查阅最新文档，建立完整的学习和实践计划

---

## ADR-002: 选择MagicOnion替代SignalR

### 决策日期
2025-08-11 (北京时间)

### 决策状态
✅ 已采纳

---

## ADR-003: 彻底清理传统架构代码

### 决策日期
2025-08-11 (北京时间)

### 决策状态
✅ 已采纳

### 决策背景
在完成初步清理后发现，保留的Wind.Core项目仍包含大量传统架构代码(Service实现、EF Core模型、SignalR Hub等)，这些与Orleans Actor模型存在根本性冲突，会导致架构混合和技术债务。

### 问题分析
1. **Wind.Core混淆**: 包含传统Service实现，与Orleans Grain模式冲突
2. **技术栈冲突**: SignalR Hub vs MagicOnion，EF Core vs Orleans状态管理
3. **架构不纯净**: 新旧架构混合会增加维护复杂度和学习成本

### 决策选择
完全删除所有传统架构代码，从零构建纯净的Orleans架构

### 彻底清理范围
1. **删除Wind.Core项目**: 包含过时的Service/Model/Interface
2. **清空Wind.Server**: 移除SignalR Hub、Controller等传统Web API代码
3. **重置Wind.Shared**: 仅保留消息协议，删除传统模型
4. **重构Wind.Tests**: 完全重写为Orleans测试模式

### 选择理由
1. **架构纯净性**: 避免新旧技术栈混合带来的复杂性
2. **学习效率**: 团队专注学习Orleans模式，不受传统模式干扰
3. **长期收益**: 虽然短期工作量增加，但长期维护成本更低
4. **最佳实践**: Orleans官方推荐从干净的基础开始构建

### 预期影响
- **正面**: 架构清晰、学习路径简单、符合Orleans最佳实践
- **负面**: 需要重写所有业务逻辑，开发时间延长
- **风险缓解**: 业务逻辑已通过Git保存，可随时参考；Orleans提供了完整的迁移指导

### 决策背景
需要高性能的实时通信框架来支持游戏场景，原有SignalR在性能和游戏特定功能方面存在限制。

### 备选方案
1. **保持SignalR**
   - 优点: 团队熟悉，生态成熟
   - 缺点: 性能相对较低，游戏特定功能支持有限

2. **原生gRPC**
   - 优点: 性能极高，跨平台支持好
   - 缺点: 开发复杂度高，需要大量样板代码

3. **MagicOnion**
   - 优点: 专为游戏设计，基于gRPC性能高，MessagePack序列化，Unity支持好
   - 缺点: 相对较新，生态不如SignalR成熟

4. **Socket.IO**
   - 优点: 生态成熟，跨平台支持
   - 缺点: 基于JavaScript生态，与.NET集成不够深入

### 决策选择
选择MagicOnion

### 选择理由
1. **游戏专用**: 专门为游戏场景设计，支持实时通信和API调用
2. **高性能**: 基于gRPC + MessagePack，性能远超SignalR
3. **Unity集成**: 原生支持Unity客户端开发
4. **统一框架**: API和实时通信使用同一套框架，减少复杂性
5. **生产验证**: 已在商业游戏中使用并验证

### 预期影响
- **正面**: 显著提升网络通信性能，简化客户端集成
- **负面**: 学习成本，生态相对较小
- **风险缓解**: 通过Context7查阅官方文档，建立完整的技术验证

---

*决策记录格式说明：*
- **ADR编号**: Architecture Decision Record编号
- **决策状态**: 已提议/已采纳/已废弃/已替代
- **决策背景**: 做出决策的原因和上下文
- **备选方案**: 考虑过的所有选项及其优缺点
- **选择理由**: 为什么选择这个方案
- **预期影响**: 决策的正面和负面影响，以及风险缓解措施