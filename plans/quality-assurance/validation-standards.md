# 验证流程标准

## 📋 核心验证标准 (强制执行)

### 🔴 代码提交前验证 (必过检查)
每次代码修改完成后，必须按顺序通过以下验证：

1. **🔧 构建验证**: `dotnet build Wind.sln` → 0错误 (警告可接受)
2. **📄 变更记录**: 更新`plans/change-logs/current/版本变更日志.md`
3. **📋 TODO状态**: 更新相关TODO状态为"已完成"+"已测试"
4. **🧪 功能验证**: 验证声称的功能确实可用

### 🟡 新功能开发验证 (开发流程)
开发新功能时的标准流程：

1. **📚 架构调研**: 查看现有相关代码和文档
2. **🔍 兼容性检查**: 确保不与现有结构冲突
3. **🔧 渐进式实现**: 每次添加新文件后立即验证编译
4. **📝 文档同步**: 确保与现有规范一致

### 🟢 完整验证流程 (里程碑验证)
重要功能完成或版本发布前：

1. **🏗️ 完整构建**: 所有项目编译通过
2. **🧪 回归测试**: 运行相关测试套件
3. **📊 测试覆盖**: 确保关键功能有测试覆盖
4. **📄 文档更新**: 同步所有相关文档

---

## 🚨 问题预防机制

### 避免架构冲突
基于2025-08-29 v1.3编译冲突问题的经验：

**🔍 开发前检查**:
- 搜索现有相关文件和类：`grep -r "ClassName" --include="*.cs"`
- 检查现有协议结构：`Wind.Shared.Protocols\`
- 查看相关接口和基类定义

**✅ 实现规范**:
- 优先扩展现有类而非创建新类
- 新文件命名避免与现有文件类似
- 依赖的类型必须确认存在

**🔧 编译监控**:
- 每次添加新文件后立即构建验证
- 出现编译错误立即分析和修复
- 不积累编译问题到批量处理

### 避免依赖问题
**📦 包引用检查**:
- 新增依赖前检查是否已存在
- 确认包版本与现有技术栈兼容
- 记录依赖添加原因和用途

**🔗 服务注册检查**:
- 确保依赖注入服务已正确注册
- 验证接口实现和生命周期配置
- 测试服务解析和初始化

---

## 📊 验证等级标准

### 🟢 基础验证 (最低要求)
- ✅ 编译通过 (0错误)
- ✅ 基本功能可用
- ✅ 无明显逻辑错误

### 🟡 标准验证 (推荐级别)
- ✅ 基础验证 +
- ✅ 单元测试通过
- ✅ 边界条件处理
- ✅ 错误情况处理

### 🔴 完整验证 (发布级别)
- ✅ 标准验证 +
- ✅ 集成测试通过
- ✅ 性能基准达标
- ✅ 文档完整准确

---

## 🔄 验证工作流

### 日常开发流程
```
开发 → 构建验证 → 功能测试 → 记录更新 → 标记完成
```

### 功能集成流程
```
设计 → 架构检查 → 实现 → 单元测试 → 集成验证 → 文档同步
```

### 版本发布流程
```
功能完成 → 回归测试 → 性能验证 → 文档审核 → 发布标记
```

---

## 📝 验证记录规范

### 构建验证记录
**格式**:
```
✅ 构建验证通过 (2025-08-29 00:14)
- dotnet build Wind.sln: 0错误, N个警告
- 影响文件: [列出修改的文件]
- 测试验证: [描述验证的功能]
```

### 问题解决记录
**格式**:
```
⚠️ [问题类型] - [问题简述]
- 发现时间: 2025-08-29 00:00
- 解决时间: 2025-08-29 00:14
- 问题原因: [根本原因分析]
- 解决方案: [具体修复步骤]
- 预防措施: [避免重复的机制]
```

### 功能验证记录
**格式**:
```
🧪 功能验证 - [功能名称]
- 验证时间: 2025-08-29 00:14
- 验证范围: [列出验证的功能点]
- 验证结果: [通过率、失败详情]
- 遗留问题: [未解决的问题]
```

---

## 🎯 质量目标

### 构建质量目标
- **零编译错误**: 每次提交前确保编译通过
- **最小化警告**: 控制警告数量在合理范围内
- **快速构建**: 单次构建时间控制在合理范围

### 测试质量目标
- **核心功能覆盖**: 关键业务逻辑100%测试覆盖
- **回归测试**: 每次功能修改后运行相关测试
- **真实测试**: 禁止假测试，确保测试结果可信

### 文档质量目标
- **同步更新**: 代码修改与文档同步更新
- **准确性**: 文档内容与实际实现保持一致
- **可追溯**: 变更记录完整，便于问题追溯

---

## 🔧 工具和自动化

### 验证工具
- **构建验证**: `dotnet build Wind.sln`
- **测试运行**: `dotnet test Wind.Tests\`
- **代码搜索**: `grep -r "pattern" --include="*.cs"`

### 自动化检查
- 构建状态监控
- 测试结果统计
- 文档更新提醒

### 质量度量
- 编译错误/警告趋势
- 测试通过率统计
- 问题解决时间分析

---

## 📚 最佳实践总结

### 开发实践
1. **小步快跑**: 频繁的小量修改和验证
2. **及时反馈**: 遇到问题立即分析解决
3. **文档先行**: 重要决策和设计先写文档

### 质量实践
1. **预防优于修复**: 建立机制避免重复问题
2. **持续验证**: 不积累问题到批量处理
3. **经验分享**: 及时记录和分享解决方案

### 协作实践
1. **透明沟通**: 及时更新工作状态和遇到的问题
2. **知识共享**: 将解决方案记录到问题跟踪机制
3. **标准遵循**: 严格按照验证流程标准执行