# 技术研究记录

## 说明
记录通过Context7和WebSearch查阅的最新技术文档和关键信息。

---

## Orleans .NET 9 研究记录

### 研究日期: 2025-01-11
### 研究方式: WebSearch (Context7暂时无法访问)
### 研究来源: Microsoft Learn官方文档

#### 核心发现

##### 1. Orleans现代化宿主模式 (.NET 9兼容)
```csharp
// Program.cs - 现代化的Orleans Silo宿主配置
using Microsoft.Extensions.Hosting;

await Host.CreateDefaultBuilder(args)
    .UseOrleans(siloBuilder => 
    {
        siloBuilder.UseLocalhostClustering(); // 本地开发环境
        siloBuilder.ConfigureEndpoints(siloPort: 11111, gatewayPort: 30000);
    })
    .RunConsoleAsync();
```

##### 2. 生产环境配置示例
```csharp
using IHost host = Host.CreateDefaultBuilder(args)
    .UseOrleans(builder => 
    {
        builder.UseAzureStorageClustering(options => 
            options.ConfigureTableServiceClient(connectionString));
    })
    .UseConsoleLifetime()
    .Build();
```

##### 3. 关键配置要素
- **ClusterId**: 集群唯一标识，同一集群内所有Silo和Client可以直接通信
- **ServiceId**: 应用唯一标识，用于持久化提供程序，部署过程中应保持稳定
- **端口配置**: 
  - 默认Silo间通信端口: 11111
  - 默认Client-Silo通信端口: 30000
  - 可通过ConfigureEndpoints自定义

##### 4. 必需的NuGet包
- **开发Silo**: `Microsoft.Orleans.Server` + `Microsoft.Extensions.Hosting`
- **架构**: 遵循.NET现代化配置模式和依赖注入

---

## MagicOnion 研究记录

### 研究日期: 2025-01-11
### 研究方式: WebSearch + GitHub官方文档
### 最新版本: v7.0.6 (2024活跃维护)

#### 核心发现

##### 1. MagicOnion特性
- **统一框架**: 同时支持RPC API和实时通信(类似SignalR)
- **基于gRPC**: HTTP/2二进制传输，高性能
- **MessagePack序列化**: 最快的C#二进制序列化器
- **代码共享**: C#接口作为协议架构，无需.proto文件
- **Unity支持**: Unity 2021.3.0f1(LTS)以上版本

##### 2. 服务端配置 (ASP.NET Core)
```csharp
// Program.cs - MagicOnion服务端设置
using MagicOnion;
using MagicOnion.Server;

var builder = WebApplication.CreateBuilder(args);
builder.Services.AddMagicOnion(); // 添加MagicOnion服务

var app = builder.Build();
app.MapMagicOnionService(); // 映射MagicOnion服务
```

##### 3. 服务接口定义
```csharp
// 共享接口定义 (Server + Client)
using MagicOnion;

public interface IMyFirstService : IService<IMyFirstService>
{
    // 返回类型必须是UnaryResult<T>或UnaryResult
    UnaryResult<int> SumAsync(int x, int y);
}
```

##### 4. 服务实现
```csharp
// 服务端实现
using MagicOnion.Server;

public class MyFirstService : ServiceBase<IMyFirstService>, IMyFirstService
{
    public async UnaryResult<int> SumAsync(int x, int y)
    {
        Console.WriteLine($"Received:{x}, {y}");
        return x + y;
    }
}
```

##### 5. 客户端使用
```csharp
// 客户端调用
using Grpc.Net.Client;
using MagicOnion.Client;

var channel = GrpcChannel.ForAddress("https://localhost:5001");
var client = MagicOnionClient.Create<IMyFirstService>(channel);
var result = await client.SumAsync(123, 456);
```

##### 6. Unity特殊考虑
- **MessagePack单独安装**: MagicOnion包不包含MessagePack，需要单独安装
- **HTTP客户端**: 推荐使用YetAnotherHttpHandler替代过时的C-core库
- **StreamingHub**: 支持全类型化的实时通信，类似SignalR但性能更高

##### 7. 架构优势
- **性能**: 基于gRPC + MessagePack，比传统SignalR快数倍
- **开发效率**: C#接口共享，无需维护额外的协议定义文件
- **游戏专用**: 专门为Unity游戏场景优化
- **商业验证**: 已在多个商业游戏中使用

#### 技术决策验证

基于研究结果，我们之前的技术选型完全正确：

1. **Orleans 9.2.1**: 完全支持.NET 9，使用现代化宿主模式
2. **MagicOnion 7.0.6**: 活跃维护，专为游戏优化，性能卓越
3. **架构兼容性**: 两者都遵循.NET现代化开发模式，可完美集成

#### 后续行动项
1. **Orleans**: 使用Microsoft.Orleans.Server + 现代化配置
2. **MagicOnion**: 集成到Orleans宿主中，共享依赖注入容器
3. **MessagePack**: 单独安装，配置序列化选项
4. **开发环境**: 本地集群配置，生产环境使用云存储集群

---

*本记录将在项目进展过程中持续更新，记录新的技术发现和实践经验。*